webpackJsonp([86],{"1ABz":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("//Fk"),a=s.n(i),o=s("fZjL"),r=s.n(o),n=s("obnb"),l=s("y/1I"),d={name:"users-auditing",components:{SelectCard:n.a,SelectCardOption:l.a},data:function(){return{loading:!0,list:[],rolesList:[],total:1,page:1,detailShow:!1,detail:{},editShow:!1,editForm:{id:"",userName:"",userPhone:"",userEmail:"",rolesId:""},editRolesShow:!1}},computed:{editRoles:{get:function(){return""===this.editForm.rolesId?[]:this.editForm.rolesId.split(",")},set:function(t){this.editForm.rolesId=t.join(",")}}},methods:{getList:function(){var t=this;this.loading=!0,this.$http.post("/cri-cms-platform/sysUser/queryList.monitor",{pageSize:10,toPage:this.page,userStatus:"01"}).then(function(e){console.log(e),t.list=e.pages,t.total=10*e.totalPage,t.loading=!1})},openDetail:function(t){var e=this;this.$http.post("/cri-cms-platform/sysUser/updateQuery.monitor",{id:t}).then(function(t){e.detail=t,e.detailShow=!0}).catch(function(t){e.$toast(t.msg),console.log(t)})},openEdit:function(t){var e=this;if(0!==r()(this.detail).length&&this.detail.sysUser.id===t)return this.editForm.id=this.detail.sysUser.id,this.editForm.userName=this.detail.sysUser.userName,this.editForm.userPhone=this.detail.sysUser.userPhone,this.editForm.userEmail=this.detail.sysUser.userEmail,this.editForm.rolesId=this.detail.roleIds.join(","),void(this.editShow=!0);this.$http.post("/cri-cms-platform/sysUser/updateQuery.monitor",{id:t}).then(function(t){e.editForm.id=t.sysUser.id,e.editForm.userName=t.sysUser.userName,e.editForm.userPhone=t.sysUser.userPhone,e.editForm.userEmail=t.sysUser.userEmail,e.editForm.rolesId=t.roleIds.join(","),e.editShow=!0}).catch(function(t){e.$toast(t.msg),console.log(t)})},submitEdit:function(){var t=this;""!==this.editForm.userName?""!==this.editForm.userPhone?""!==this.editForm.userEmail?this.$http.post("/cri-cms-platform/sysUser/update.monitor",this.editForm).then(function(e){console.log(e),t.getList(),t.editShow=!1,t.detailShow=!1}):this.$toast("请输入用户邮箱"):this.$toast("请输入手机号码"):this.$toast("请输入用户名称")},auditUser:function(t){var e=this;this.$http.post("/cri-cms-platform/sysUser/updateAudit.monitor",{id:t}).then(function(t){e.$toast("审核成功"),e.getList(),e.detailShow=!1}).catch(function(t){e.$toast(t.msg),console.log(t)})},backPassWd:function(t){this.$confirm({title:"确定要重置用户密码？",text:"用户密码将恢复为初始密码",btns:["取消","重置"],color:"red",yes:function(){var e=this;this.$http.post("/cri-cms-platform/sysUser/backPassWd.monitor",{id:t}).then(function(t){e.$toast("密码重置成功"),e.getList(),e.detailShow=!1}).catch(function(t){e.$toast(t.msg),console.log(t)})},no:function(){}})},deleteUser:function(t){var e=this;this.$http.post("/cri-cms-platform/sysUser/del.monitor",{id:t}).then(function(t){e.$toast("删除成功"),e.getList(),e.detailShow=!1}).catch(function(t){e.$toast(t.msg),console.log(t)})},getRole:function(t){return""===t?"":this.rolesList.find(function(e){return t===e.id}).rolesCnName},selectEditRole:function(t){var e=this.editRoles.findIndex(function(e){return e===t}),s=this.editRoles.map(function(t){return t});-1===e?s.push(t):s.splice(e,1),this.editRoles=s}},filters:{status:function(t){return"00"===t?"正常":"停用"}},created:function(){var t=this;a.a.all([this.$http.post("/cri-cms-platform/sysUser/queryList.monitor",{pageSize:10,toPage:this.page,userStatus:"01"}),this.$http.post("/cri-cms-platform/sysUser/roles.monitor")]).then(function(e){console.log(e),t.list=e[0].pages,t.total=10*e[0].totalPage,t.rolesList=e[1].roles,t.loading=!1})}},c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[t._m(0),t._v(" "),s("div",{staticClass:"flex-item scroll-y bg-e relative"},[s("transition",{attrs:{name:"fade"}},[t.loading?s("div",{staticClass:"abs bg-e",staticStyle:{"z-index":"99"}},[s("loading",{staticStyle:{left:"50%",top:"50%",transform:"translate(-50%, -50%)"}})],1):t._e()]),t._v(" "),s("div",{staticClass:"setting-card f-14"},[s("table",[t._m(1),t._v(" "),s("tbody",t._l(t.list,function(e,i){return s("tr",{key:e.id,on:{click:function(s){t.openDetail(e.id)}}},[s("td",[t._v(t._s(i+1))]),t._v(" "),s("td",[t._v(t._s(e.userName))]),t._v(" "),s("td",[t._v(t._s(e.loginUserName))]),t._v(" "),s("td",[t._v(t._s(t._f("status")(e.userStatus)))]),t._v(" "),s("td",[t._v(t._s(e.userLoginTime))]),t._v(" "),s("td",[t._v(t._s(e.userLoginIp))]),t._v(" "),s("td",{staticStyle:{width:"30px"}},[s("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"重置密码",expression:"'重置密码'"}],attrs:{small:""},nativeOn:{click:function(s){s.stopPropagation(),t.backPassWd(e.id)}}},[t._v("refresh")])],1),t._v(" "),s("td",{staticStyle:{width:"30px"}},[s("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"编辑",expression:"'编辑'"}],attrs:{small:""},nativeOn:{click:function(s){s.stopPropagation(),t.openEdit(e.id)}}},[t._v("edit")])],1),t._v(" "),s("td",{staticStyle:{width:"30px"}},[s("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"停用",expression:"'停用'"}],attrs:{small:""},nativeOn:{click:function(s){s.stopPropagation(),t.deleteUser(e.id)}}},[t._v("delete")])],1)])}))]),t._v(" "),s("pagination",{staticStyle:{"justify-content":"center"},attrs:{total:t.total,size:10,page:t.page,color:"#66BB6A"}})],1)],1),t._v(" "),t.detailShow?s("layer",{attrs:{title:"用户详情",width:"600px",maskClick:""},on:{close:function(e){t.detailShow=!1}}},[s("div",{staticClass:"layer-text"},[s("table",[s("tbody",[s("tr",[s("th",{attrs:{align:"right"}},[t._v("用户ID")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.id))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("用户姓名")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.userName))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("登录名")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.loginUserName))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("登录密码")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.loginUserPwd))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("用户状态")]),t._v(" "),s("td",[t._v(t._s(t._f("status")(t.detail.sysUser.userStatus)))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("用户区域")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.userArea))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("用户手机")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.userPhone))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("Email")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.userEmail))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("创建时间")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.createTime))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("本次登录时间")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.userLoginTime))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("登录IP")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.userLoginIp))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("上次登录IP")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.userLastLoginIp))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("用户ID")]),t._v(" "),s("td",[t._v(t._s(t.detail.sysUser.id))])]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("角色")]),t._v(" "),s("td",t._l(t.detail.roleIds,function(e){return s("tag",{key:e,attrs:{small:""}},[t._v(t._s(t.getRole(e)))])}))]),t._v(" "),s("tr",[s("th",{attrs:{align:"right"}},[t._v("操作")]),t._v(" "),s("td",[s("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"重置密码",expression:"'重置密码'"}],staticStyle:{margin:"0 2px"},attrs:{small:""},nativeOn:{click:function(e){e.stopPropagation(),t.backPassWd(t.detail.sysUser.id)}}},[t._v("refresh")]),t._v(" "),s("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"编辑",expression:"'编辑'"}],staticStyle:{margin:"0 2px"},attrs:{small:""},nativeOn:{click:function(e){e.stopPropagation(),t.openEdit(t.detail.sysUser.id)}}},[t._v("edit")]),t._v(" "),s("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"删除",expression:"'删除'"}],staticStyle:{margin:"0 2px"},attrs:{small:""},nativeOn:{click:function(e){e.stopPropagation(),t.deleteUser(t.detail.sysUser.id)}}},[t._v("delete")]),t._v(" "),s("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"审核",expression:"'审核'"}],staticStyle:{margin:"0 2px"},attrs:{small:""},nativeOn:{click:function(e){e.stopPropagation(),t.auditUser(t.detail.sysUser.id)}}},[t._v("find_in_page")])],1)])])])]),t._v(" "),s("div",{staticClass:"layer-btns"},[s("btn",{attrs:{flat:"",color:"#66BB6A"},on:{click:function(e){t.detailShow=!1}}},[t._v("关闭")])],1)]):t._e(),t._v(" "),t.editShow?s("layer",{attrs:{title:"添加新用户",width:"600px"}},[s("div",{staticClass:"layer-text"},[s("input-box",{attrs:{label:"用户名称"},model:{value:t.editForm.userName,callback:function(e){t.$set(t.editForm,"userName",e)},expression:"editForm.userName"}}),t._v(" "),s("input-box",{attrs:{label:"手机号码"},model:{value:t.editForm.userPhone,callback:function(e){t.$set(t.editForm,"userPhone",e)},expression:"editForm.userPhone"}}),t._v(" "),s("input-box",{attrs:{label:"用户邮箱"},model:{value:t.editForm.userEmail,callback:function(e){t.$set(t.editForm,"userEmail",e)},expression:"editForm.userEmail"}}),t._v(" "),s("div",{staticClass:"relative input-box"},[s("label",[t._v("角色")]),t._v(" "),s("div",{staticStyle:{"padding-left":"50px"}},[t._l(t.editRoles,function(e){return s("tag",{key:e,attrs:{small:""}},[t._v(t._s(t.getRole(e)))])}),t._v(" "),s("icon-btn",{attrs:{small:""},on:{click:function(e){t.editRolesShow=!0}}},[t._v("edit")])],2)])],1),t._v(" "),s("div",{staticClass:"layer-btns"},[s("btn",{attrs:{flat:""},on:{click:function(e){t.editShow=!1}}},[t._v("取消")]),t._v(" "),s("btn",{attrs:{flat:"",color:"#66BB6A"},on:{click:t.submitEdit}},[t._v("提交")])],1)]):t._e(),t._v(" "),t.editRolesShow?s("select-card",{attrs:{value:t.editRoles,multiple:"",title:"选择用户角色",width:"600px",maskClick:""},on:{close:function(e){t.editRolesShow=!1}}},t._l(t.rolesList,function(e){return s("select-card-option",{key:e.id,attrs:{value:e.id},on:{click:function(s){t.selectEditRole(e.id)}}},[t._v(t._s(e.rolesCnName))])})):t._e()],1)};c._withStripped=!0;var v={render:c,staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"af-topbar"},[e("span",{staticClass:"f-18"},[this._v("待审")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("th",[t._v("用户ID")]),t._v(" "),s("th",[t._v("用户姓名")]),t._v(" "),s("th",[t._v("登录名")]),t._v(" "),s("th",[t._v("用户状态")]),t._v(" "),s("th",[t._v("本次登录时间")]),t._v(" "),s("th",[t._v("登录IP")]),t._v(" "),s("th",{attrs:{colspan:"4"}},[t._v("操作")])])}]},u=v;var _=!1;var h=s("VU/8")(d,u,!1,function(t){_||s("5tvB")},null,null);h.options.__file="src/apps/users/auditing.vue";e.default=h.exports},"1ST4":function(t,e,s){(t.exports=s("FZ+f")(!1)).push([t.i,"",""])},"5tvB":function(t,e,s){var i=s("1ST4");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);s("rjj0")("e9463b8e",i,!1,{})}});