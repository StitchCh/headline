webpackJsonp([113],{HvEI:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("//Fk"),o=s.n(i),n=s("fZjL"),a=s.n(n),r=s("Dd8w"),l=s.n(r),c=s("obnb"),d=s("y/1I"),u={name:"users-all",components:{SelectCard:c.a,SelectCardOption:d.a},data:function(){return{loading:!0,list:[],rolesList:[],total:1,page:1,detailShow:!1,detail:{},newShow:!1,vertify:{newLoginUserPwd:""},newForm:{userName:"",loginUserName:"",userPhone:"",userEmail:"",rolesId:"",isAllQuery:!1,isPassIssue:!1,isUpdateDown:!1},newLoginUserNameHint:"",editShow:!1,editForm:{id:"",userName:"",userPhone:"",userEmail:"",rolesId:""},newRolesShow:!1,editRolesShow:!1}},computed:{newRoles:{get:function(){return""===this.newForm.rolesId?[]:this.newForm.rolesId.split(",")},set:function(t){this.newForm.rolesId=t.join(",")}},editRoles:{get:function(){return""===this.editForm.rolesId?[]:this.editForm.rolesId.split(",")},set:function(t){this.editForm.rolesId=t.join(",")}}},methods:{getList:function(){var t=this;this.loading=!0,this.$http.post("/cri-cms-platform/sysUser/queryList.monitor",{pageSize:10,toPage:this.page}).then(function(e){console.log(e),t.list=e.pages,t.total=10*e.totalPage,t.loading=!1})},openDetail:function(t){var e=this;this.$http.post("/cri-cms-platform/sysUser/updateQuery.monitor",{id:t}).then(function(t){e.detail=t,e.detailShow=!0}).catch(function(t){e.$toast(t.msg),console.log(t)})},openNew:function(){this.vertify.newLoginUserPwd="",this.newForm={userName:"",loginUserName:"",userPhone:"",userEmail:"",rolesId:"",isAllQuery:!1,isPassIssue:!1,isUpdateDown:!1},this.newLoginUserNameHint="",this.newShow=!0},vertifyLoginUserName:function(){var t=this;""!==this.newForm.loginUserName&&this.$http.post("/cri-cms-platform/sysUser/valident.monitor",{param:this.newForm.loginUserName}).then(function(e){console.log(e),Number(e.validate)?t.newLoginUserNameHint="登录名可用":t.newLoginUserNameHint="登录名不可用"}).catch(function(e){console.log(e),t.$toast(e.msg)})},submitNew:function(){var t=this;if(""!==this.newForm.userName)if(""!==this.newForm.loginUserName)if("登录名不可用"!==this.newLoginUserNameHint)if(""!==this.newForm.userPhone)if(""!==this.newForm.userEmail){var e=l()({},this.newForm);e.isAllQuery=1==e.isAllQuery?1:0,e.isPassIssue=1==e.isPassIssue?1:0,e.isUpdateDown=1==e.isUpdateDown?1:0,this.$http.post("/cri-cms-platform/sysUser/save.monitor",e).then(function(e){t.$toast(e.msg),t.getList(),t.newShow=!1}).catch(function(e){t.$toast(e.msg),console.log(e)})}else this.$toast("请输入用户邮箱");else this.$toast("请输入手机号码");else this.$toast("登录名不可用");else this.$toast("请输入登录名称");else this.$toast("请输入用户名称")},openEdit:function(t){var e=this;if(0!==a()(this.detail).length&&this.detail.sysUser.id===t)return this.editForm.id=this.detail.sysUser.id,this.editForm.userName=this.detail.sysUser.userName,this.editForm.userPhone=this.detail.sysUser.userPhone,this.editForm.userEmail=this.detail.sysUser.userEmail,this.editForm.rolesId=this.detail.roleIds.join(","),this.editForm.isAllQuery=0!=this.detail.isAllQuery,this.editForm.isPassIssue=0!=this.detail.isPassIssue,this.editForm.isUpdateDown=0!=this.detail.isUpdateDown,void(this.editShow=!0);this.$http.post("/cri-cms-platform/sysUser/updateQuery.monitor",{id:t}).then(function(t){e.editForm.id=t.sysUser.id,e.editForm.userName=t.sysUser.userName,e.editForm.userPhone=t.sysUser.userPhone,e.editForm.userEmail=t.sysUser.userEmail,e.editForm.rolesId=t.roleIds.join(","),e.editForm.isAllQuery=0!=t.sysUser.isAllQuery,e.editForm.isPassIssue=0!=t.sysUser.isPassIssue,e.editForm.isUpdateDown=0!=t.sysUser.isUpdateDown,e.editShow=!0,console.log(t)}).catch(function(t){e.$toast(t.msg),console.log(t)})},submitEdit:function(){var t=this;if(""!==this.editForm.userName)if(""!==this.editForm.userPhone)if(""!==this.editForm.userEmail){var e=l()({},this.editForm);e.isAllQuery=1==e.isAllQuery?1:0,e.isPassIssue=1==e.isPassIssue?1:0,e.isUpdateDown=1==e.isUpdateDown?1:0,this.$http.post("/cri-cms-platform/sysUser/update.monitor",e).then(function(e){t.getList(),t.editShow=!1,t.detailShow=!1})}else this.$toast("请输入用户邮箱");else this.$toast("请输入手机号码");else this.$toast("请输入用户名称")},auditUser:function(t){var e=this;this.$http.post("/cri-cms-platform/sysUser/updateAudit.monitor",{id:t}).then(function(t){e.$toast("审核成功"),e.getList(),e.detailShow=!1}).catch(function(t){e.$toast(t.msg),console.log(t)})},backPassWd:function(t){var e=this;this.$confirm({title:"确定要重置用户密码？",text:"用户密码将恢复为初始密码",btns:["取消","重置"],color:"red",yes:function(){e.$http.post("/cri-cms-platform/sysUser/backPassWd.monitor",{id:t}).then(function(t){console.log(t),e.$toast(t.msg),e.getList(),e.detailShow=!1}).catch(function(t){e.$toast(t.msg),console.log(t)})},no:function(){}})},deleteUser:function(t){var e=this;this.$http.post("/cri-cms-platform/sysUser/del.monitor",{id:t}).then(function(t){e.$toast("删除成功"),e.getList(),e.detailShow=!1}).catch(function(t){e.$toast(t.msg),console.log(t)})},restoreUser:function(t){var e=this;this.$http.post("/cri-cms-platform/sysUser/userStatusBack.monitor",{id:t}).then(function(t){e.$toast("恢复成功"),e.getList(),e.detailShow=!1}).catch(function(t){e.$toast(t.msg),console.log(t)})},getRole:function(t){return""===t?"":this.rolesList.find(function(e){return t===e.id}).rolesCnName},selectNewRole:function(t){var e=this.newRoles.findIndex(function(e){return e===t}),s=this.newRoles.map(function(t){return t});-1===e?s.push(t):s.splice(e,1),this.newRoles=s},selectEditRole:function(t){var e=this.editRoles.findIndex(function(e){return e===t}),s=this.editRoles.map(function(t){return t});-1===e?s.push(t):s.splice(e,1),this.editRoles=s}},filters:{status:function(t){return"00"===t?"正常":"停用"}},created:function(){var t=this;o.a.all([this.$http.post("/cri-cms-platform/sysUser/queryList.monitor",{pageSize:10,toPage:this.page}),this.$http.post("/cri-cms-platform/sysUser/roles.monitor")]).then(function(e){console.log(e),t.list=e[0].pages,t.total=10*e[0].totalPage,t.rolesList=e[1].roles,t.loading=!1})}},m=function(){var t=this,e=this,s=e.$createElement,i=e._self._c||s;return i("div",[e._m(0),e._v(" "),i("div",{staticClass:"flex-item scroll-y bg-e relative"},[i("transition",{attrs:{name:"fade"}},[e.loading?i("div",{staticClass:"abs bg-e",staticStyle:{"z-index":"99"}},[i("loading",{staticStyle:{left:"50%",top:"50%",transform:"translate(-50%, -50%)"}})],1):e._e()]),e._v(" "),i("div",{staticClass:"setting-card f-16 add-btn",on:{click:e.openNew}},[e._v("\n      添加新用户...\n    ")]),e._v(" "),i("div",{staticClass:"setting-card f-14"},[i("table",[e._m(1),e._v(" "),i("tbody",e._l(e.list,function(t,s){return i("tr",{key:t.id,on:{click:function(s){e.openDetail(t.id)}}},[i("td",[e._v(e._s(s+1))]),e._v(" "),i("td",[e._v(e._s(t.userName))]),e._v(" "),i("td",[e._v(e._s(t.loginUserName))]),e._v(" "),i("td",[e._v(e._s(t.roleName))]),e._v(" "),i("td",[e._v(e._s("00"==t.userStatus?"正常":"停用"))]),e._v(" "),i("td",[e._v(e._s(t.userLoginTime))]),e._v(" "),i("td",[e._v(e._s(t.userLoginIp))]),e._v(" "),i("td",{staticStyle:{width:"30px"}},[i("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"重置密码",expression:"'重置密码'"}],attrs:{small:""},nativeOn:{click:function(s){s.stopPropagation(),e.backPassWd(t.id)}}},[e._v("refresh")])],1),e._v(" "),i("td",{staticStyle:{width:"30px"}},[i("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"编辑",expression:"'编辑'"}],attrs:{small:""},nativeOn:{click:function(s){s.stopPropagation(),e.openEdit(t.id)}}},[e._v("edit")])],1),e._v(" "),i("td",{staticStyle:{width:"30px"}},["00"==t.userStatus?i("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"停用",expression:"'停用'"}],attrs:{small:""},nativeOn:{click:function(s){s.stopPropagation(),e.deleteUser(t.id)}}},[e._v("delete")]):i("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"恢复",expression:"'恢复'"}],attrs:{small:""},nativeOn:{click:function(s){s.stopPropagation(),e.restoreUser(t.id)}}},[e._v("restore_from_trash")])],1)])}))]),e._v(" "),i("pagination",{staticStyle:{"justify-content":"center"},attrs:{total:e.total,size:10,page:e.page,color:"#66BB6A"},on:{change:function(s){e.page=s,t.getList()}}})],1)],1),e._v(" "),e.detailShow?i("layer",{attrs:{title:"用户详情",width:"600px",maskClick:""},on:{close:function(t){e.detailShow=!1}}},[i("div",{staticClass:"layer-text"},[i("table",[i("tbody",[i("tr",[i("th",{attrs:{align:"right"}},[e._v("用户姓名")]),e._v(" "),i("td",[e._v(e._s(e.detail.sysUser.userName))])]),e._v(" "),i("tr",[i("th",{attrs:{align:"right"}},[e._v("登录名")]),e._v(" "),i("td",[e._v(e._s(e.detail.sysUser.loginUserName))])]),e._v(" "),i("tr",[i("th",{attrs:{align:"right"}},[e._v("用户状态")]),e._v(" "),i("td",[e._v(e._s("00"==e.detail.sysUser.userStatus?"正常":"停用"))])]),e._v(" "),i("tr",[i("th",{attrs:{align:"right"}},[e._v("用户手机")]),e._v(" "),i("td",[e._v(e._s(e.detail.sysUser.userPhone))])]),e._v(" "),i("tr",[i("th",{attrs:{align:"right"}},[e._v("Email")]),e._v(" "),i("td",[e._v(e._s(e.detail.sysUser.userEmail))])]),e._v(" "),i("tr",[i("th",{attrs:{align:"right"}},[e._v("创建时间")]),e._v(" "),i("td",[e._v(e._s(e.detail.sysUser.createTime))])]),e._v(" "),i("tr",[i("th",{attrs:{align:"right"}},[e._v("本次登录时间")]),e._v(" "),i("td",[e._v(e._s(e.detail.sysUser.userLoginTime))])]),e._v(" "),i("tr",[i("th",{attrs:{align:"right"}},[e._v("登录IP")]),e._v(" "),i("td",[e._v(e._s(e.detail.sysUser.userLoginIp))])]),e._v(" "),i("tr",[i("th",{attrs:{align:"right"}},[e._v("角色")]),e._v(" "),i("td",e._l(e.detail.roleIds,function(t){return i("tag",{key:t,attrs:{small:""}},[e._v(e._s(e.getRole(t)))])}))]),e._v(" "),i("tr",[i("th",{attrs:{align:"right"}},[e._v("操作")]),e._v(" "),i("td",[i("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"重置密码",expression:"'重置密码'"}],attrs:{small:""},nativeOn:{click:function(t){t.stopPropagation(),e.backPassWd(e.detail.sysUser.id)}}},[e._v("refresh")]),e._v(" "),i("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"编辑",expression:"'编辑'"}],attrs:{small:""},nativeOn:{click:function(t){t.stopPropagation(),e.openEdit(e.detail.sysUser.id)}}},[e._v("edit")]),e._v(" "),"02"!==e.detail.sysUser.userStatus?i("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"删除",expression:"'删除'"}],attrs:{small:""},nativeOn:{click:function(t){t.stopPropagation(),e.deleteUser(e.detail.sysUser.id)}}},[e._v("delete")]):i("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"恢复",expression:"'恢复'"}],attrs:{small:""},nativeOn:{click:function(t){t.stopPropagation(),e.restoreUser(e.detail.sysUser.id)}}},[e._v("restore_from_trash")]),e._v(" "),"01"===e.detail.sysUser.userStatus?i("icon-btn",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"审核",expression:"'审核'"}],attrs:{small:""},nativeOn:{click:function(t){t.stopPropagation(),e.auditUser(e.detail.sysUser.id)}}},[e._v("find_in_page")]):e._e()],1)])])])]),e._v(" "),i("div",{staticClass:"layer-btns"},[i("btn",{attrs:{flat:"",color:"#66BB6A"},on:{click:function(t){e.detailShow=!1}}},[e._v("关闭")])],1)]):e._e(),e._v(" "),e.newShow?i("layer",{attrs:{title:"添加新用户",width:"600px"}},[i("div",{staticClass:"layer-text"},[i("input-box",{attrs:{label:"用户名称"},model:{value:e.newForm.userName,callback:function(t){e.$set(e.newForm,"userName",t)},expression:"newForm.userName"}}),e._v(" "),i("input-box",{attrs:{label:"登录名称",hint:e.newLoginUserNameHint},on:{blur:e.vertifyLoginUserName},model:{value:e.newForm.loginUserName,callback:function(t){e.$set(e.newForm,"loginUserName",t)},expression:"newForm.loginUserName"}}),e._v(" "),i("input-box",{attrs:{label:"手机号码"},model:{value:e.newForm.userPhone,callback:function(t){e.$set(e.newForm,"userPhone",t)},expression:"newForm.userPhone"}}),e._v(" "),i("input-box",{attrs:{label:"用户邮箱"},model:{value:e.newForm.userEmail,callback:function(t){e.$set(e.newForm,"userEmail",t)},expression:"newForm.userEmail"}}),e._v(" "),i("div",[i("check-box",{staticStyle:{width:"30%"},attrs:{text:"是否查看全部记录"},model:{value:e.newForm.isAllQuery,callback:function(t){e.$set(e.newForm,"isAllQuery",t)},expression:"newForm.isAllQuery"}}),e._v(" "),i("check-box",{staticStyle:{width:"30%"},attrs:{text:"是否跳过审核"},model:{value:e.newForm.isPassIssue,callback:function(t){e.$set(e.newForm,"isPassIssue",t)},expression:"newForm.isPassIssue"}}),e._v(" "),i("check-box",{staticStyle:{width:"30%"},attrs:{text:"是否修改后下架"},model:{value:e.newForm.isUpdateDown,callback:function(t){e.$set(e.newForm,"isUpdateDown",t)},expression:"newForm.isUpdateDown"}})],1),e._v(" "),i("div",{staticClass:"relative input-box"},[i("label",[e._v("角色")]),e._v(" "),i("div",{staticStyle:{"padding-left":"50px"}},[e._l(e.newRoles,function(t){return i("tag",{key:t,attrs:{small:""}},[e._v(e._s(e.getRole(t)))])}),e._v(" "),i("icon-btn",{attrs:{small:""},on:{click:function(t){e.newRolesShow=!0}}},[e._v("edit")])],2)])],1),e._v(" "),i("div",{staticClass:"layer-btns"},[i("btn",{attrs:{flat:""},on:{click:function(t){e.newShow=!1}}},[e._v("取消")]),e._v(" "),i("btn",{attrs:{flat:"",color:"#66BB6A"},on:{click:e.submitNew}},[e._v("提交")])],1)]):e._e(),e._v(" "),e.editShow?i("layer",{attrs:{title:"编辑用户",width:"600px"}},[i("div",{staticClass:"layer-text"},[i("input-box",{attrs:{label:"用户名称"},model:{value:e.editForm.userName,callback:function(t){e.$set(e.editForm,"userName",t)},expression:"editForm.userName"}}),e._v(" "),i("input-box",{attrs:{label:"手机号码"},model:{value:e.editForm.userPhone,callback:function(t){e.$set(e.editForm,"userPhone",t)},expression:"editForm.userPhone"}}),e._v(" "),i("input-box",{attrs:{label:"用户邮箱"},model:{value:e.editForm.userEmail,callback:function(t){e.$set(e.editForm,"userEmail",t)},expression:"editForm.userEmail"}}),e._v(" "),i("div",[i("check-box",{staticStyle:{width:"30%"},attrs:{text:"是否查看全部记录"},model:{value:e.editForm.isAllQuery,callback:function(t){e.$set(e.editForm,"isAllQuery",t)},expression:"editForm.isAllQuery"}}),e._v(" "),i("check-box",{staticStyle:{width:"30%"},attrs:{text:"是否跳过审核"},model:{value:e.editForm.isPassIssue,callback:function(t){e.$set(e.editForm,"isPassIssue",t)},expression:"editForm.isPassIssue"}}),e._v(" "),i("check-box",{staticStyle:{width:"30%"},attrs:{text:"是否修改后下架"},model:{value:e.editForm.isUpdateDown,callback:function(t){e.$set(e.editForm,"isUpdateDown",t)},expression:"editForm.isUpdateDown"}})],1),e._v(" "),i("div",{staticClass:"relative input-box"},[i("label",[e._v("角色")]),e._v(" "),i("div",{staticStyle:{"padding-left":"50px"}},[e._l(e.editRoles,function(t){return i("tag",{key:t,attrs:{small:""}},[e._v(e._s(e.getRole(t)))])}),e._v(" "),i("icon-btn",{attrs:{small:""},on:{click:function(t){e.editRolesShow=!0}}},[e._v("edit")])],2)])],1),e._v(" "),i("div",{staticClass:"layer-btns"},[i("btn",{attrs:{flat:""},on:{click:function(t){e.editShow=!1}}},[e._v("取消")]),e._v(" "),i("btn",{attrs:{flat:"",color:"#66BB6A"},on:{click:e.submitEdit}},[e._v("提交")])],1)]):e._e(),e._v(" "),e.newRolesShow?i("select-card",{attrs:{value:e.newRoles,multiple:"",title:"选择用户角色",width:"600px",maskClick:""},on:{close:function(t){e.newRolesShow=!1}}},e._l(e.rolesList,function(t){return i("select-card-option",{key:t.id,attrs:{value:t.id},on:{click:function(s){e.selectNewRole(t.id)}}},[e._v(e._s(t.rolesCnName))])})):e._e(),e._v(" "),e.editRolesShow?i("select-card",{attrs:{value:e.editRoles,multiple:"",title:"选择用户角色",width:"600px",maskClick:""},on:{close:function(t){e.editRolesShow=!1}}},e._l(e.rolesList,function(t){return i("select-card-option",{key:t.id,attrs:{value:t.id},on:{click:function(s){e.selectEditRole(t.id)}}},[e._v(e._s(t.rolesCnName))])})):e._e()],1)};m._withStripped=!0;var v={render:m,staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"af-topbar"},[e("span",{staticClass:"f-18"},[this._v("全部")])])},function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("thead",[s("th",[t._v("序号")]),t._v(" "),s("th",[t._v("用户姓名")]),t._v(" "),s("th",[t._v("登录名")]),t._v(" "),s("th",[t._v("角色")]),t._v(" "),s("th",[t._v("用户状态")]),t._v(" "),s("th",[t._v("本次登录时间")]),t._v(" "),s("th",[t._v("登录IP")]),t._v(" "),s("th",{attrs:{colspan:"4"}},[t._v("操作")])])}]},h=v;var p=!1;var _=s("VU/8")(u,h,!1,function(t){p||s("Kf+b")},null,null);_.options.__file="src/apps/users/all.vue";e.default=_.exports},"Kf+b":function(t,e,s){var i=s("rs+d");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);s("rjj0")("71d8afb8",i,!1,{})},"rs+d":function(t,e,s){(t.exports=s("FZ+f")(!1)).push([t.i,"",""])}});