webpackJsonp([44],{KRZt:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=n("mvHQ"),a=n.n(s),i=n("2get"),o=n("MYRd"),r={name:"app-work",components:{Account:i.a,AfLeft:o.a},data:function(){return{loading:!1,publishLoading:!1,channel:[],layout:[],scrollTop:0}},created:function(){this.getChannel(),this.getLayout()},watch:{"$route.query.channelId":function(){this.getLayout()}},methods:{scrollfun:function(){this.scrollTop=this.$refs.scrollbox.scrollTop},getChannel:function(){var t=this;this.$http.post("/cri-cms-platform/issue/getChannels.monitor").then(function(e){e.forEach(function(t){t.name=t.channelName}),console.log(e),t.channel=e}).catch(function(e){t.$toast(e.msg)})},getLayout:function(){var t=this;this.$route.query.channelId&&(this.loading=!0,this.$http.post("/cri-cms-platform/channel/getChannelIdToLayout.monitor",{channelId:this.$route.query.channelId}).then(function(e){t.loading=!1,t.layout=e}).catch(function(e){t.loading=!1,t.$toast(e.msg)}))},onTreeSelect:function(t){this.$router.replace({path:this.$route.path,query:{channelId:t.id}})},onTab:function(t){this.$router.replace({path:t,query:this.$route.query})},publish:function(){var t=this;this.publishLoading=!0,this.submitIssue(function(){t.$toast("发布成功"),t.refresh(),t.publishLoading=!1})},submitIssue:function(t){var e=this,n={results:{data:this.$refs.published.getIssueResult()}};n=a()(n),this.$http.post("/cri-cms-platform/issue/saveIssue.monitor",{issueJson:n,channelId:this.$route.query.channelId}).then(function(e){t&&t()}).catch(function(t){e.publishLoading=!1,e.$toast(t.msg)})},refresh:function(){var t=this,e=this.$route.query,n=this.$route.path;this.$router.replace({path:n}),setTimeout(function(){t.$router.replace({path:n,query:e})},10)},onAdd:function(t){var e=this;this.$router.replace({path:"/works",query:this.$route.query}),setTimeout(function(){e.$refs.published.add(t)},50)}}},l=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"abs bg-f flex app-work"},[n("af-left",{staticStyle:{width:"220px"},attrs:{"bg-color":"#fafafa","vibrant-color":"#008cff",title:"发布"}},[n("div",{staticClass:"f-12 c-8",staticStyle:{padding:"3px 20px"}},[t._v("频道列表")]),t._v(" "),n("tree",{staticClass:"c-4",attrs:{data:t.channel,activeId:t.$route.query.channelId,pidTxt:"channelPartentId"},on:{select:t.onTreeSelect}})],1),t._v(" "),n("div",{staticClass:"flex-item flex-col",staticStyle:{overflow:"hidden"}},[n("div",{staticClass:"af-topbar flex-v-center",staticStyle:{background:"rgb(244, 244, 244)"}},[t.$route.query.channelId?n("div",{staticStyle:{width:"250px","margin-left":"5px"}},["works-published"===t.$route.name?n("div",[n("btn",{on:{click:t.publish}},[t._v("发布")]),t._v(" "),n("btn",{attrs:{flat:""},on:{click:t.refresh}},[t._v("撤销更改")]),t._v(" "),n("btn",{attrs:{flat:""},on:{click:function(e){t.$router.replace({path:"/works/history",query:t.$route.query})}}},[t._v("发布历史")])],1):t._e(),t._v(" "),"works-published"!=t.$route.name?n("div",[n("btn",{on:{click:function(e){t.onTab("/works")}}},[t._v("返回")])],1):t._e()]):t._e(),t._v(" "),n("div",{staticClass:"flex-item flex-center"}),t._v(" "),n("account")],1),t._v(" "),t.$route.query.channelId?n("div",{staticClass:"flex-item flex-col relative",staticStyle:{background:"#f4f4f4"}},[n("div",{ref:"scrollbox",staticClass:"flex-item relative scroll-y",staticStyle:{padding:"20px"},on:{scroll:t.scrollfun}},[n("keep-alive",[n("router-view",{ref:"published",attrs:{layout:t.layout,channel:t.channel,scrollTop:t.scrollTop},on:{add:t.onAdd,dragend:function(e){t.layout=e}}})],1)],1)]):t._e()]),t._v(" "),t.publishLoading?n("layer",[n("div",{staticClass:"layer-text relative flex-center"},[n("loading",{attrs:{size:"30"}}),t._v(" "),n("span",{staticClass:"b c-6 f-16",staticStyle:{margin:"0 10px","line-height":"1em"}},[t._v("正在发布")])],1)]):t._e()],1)};l._withStripped=!0;var c={render:l,staticRenderFns:[]},u=c;var h=!1;var f=n("VU/8")(r,u,!1,function(t){h||n("Z6A6")},null,null);f.options.__file="src/apps/works/index.vue";e.default=f.exports},Z6A6:function(t,e,n){var s=n("v4WO");"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);n("rjj0")("5f96ebe8",s,!1,{})},v4WO:function(t,e,n){(t.exports=n("FZ+f")(!1)).push([t.i,"",""])}});