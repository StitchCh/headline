webpackJsonp([29],{"K5+Q":function(t,e,s){var i=s("YUvd");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);s("rjj0")("867370f0",i,!1,{})},YUvd:function(t,e,s){(t.exports=s("FZ+f")(!1)).push([t.i,"\n.add-relates .item {\n  padding: 7px 4px;\n}\n.add-relates .item span {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n.add-relates .item i:hover {\n  color: #F44336;\n}\n.add-relates .movelist {\n  background: #008eff;\n  color: #008eff;\n  opacity: 0.5;\n}\n.add-relates .layer-ctn {\n  max-width: 1000px;\n}\n.add-relates .title {\n  margin: 10px 0;\n  font-size: 12px;\n}\n.add-relates .content {\n  background: #fff;\n  border-radius: 10px;\n  overflow: hidden;\n  margin-bottom: 10px;\n  max-height: 600px;\n  overflow-y: auto;\n}\n.add-relates .content li {\n  padding-left: 20px;\n  cursor: pointer;\n}\n.add-relates .content li div {\n  border-bottom: 1px solid #e1e1e1;\n  padding: 12px 0;\n}\n.add-relates .content li:hover {\n  background: #e1e1e1;\n}\n.add-relates .content li:last-child div {\n  border-bottom: 0;\n}\n.add-relates .content .none {\n  padding: 0;\n  cursor: default;\n}\n.add-relates .content .none:hover {\n  background: none;\n}\n",""])},ZRBH:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("DAYN"),n={name:"app-article-add-relates",components:{draggable:s.n(i).a},props:{value:{},limit:{},channelId:{type:String},single:{type:Boolean,default:!1},channels:{type:Array},title:{type:String,default:""},icon:{type:String,default:""},url:{type:String,default:""}},data:function(){return{show:!1,loading:!0,list:{selected:[],unselected:[]},form:{selectedIds:"",title:"",channelId:""},channelShow:!1,channelIds:[],firstclick:!0}},mounted:function(){this.value.selected&&(this.list.selected=this.value.selected)},methods:{clickget:function(){if(this.show=!0,!this.firstclick)return!1;this.firstclick=!1,this.getList()},getList:function(){var t=this;return this.loading=!0,this.$http.post(this.url,this.form).then(function(e){t.list.unselected=e||{},t.loading=!1}).catch(function(t){console.log(t)})},searchTitle:function(){""!==this.form.title&&this.getList()},select:function(t){if(this.single)return this.list.selected.splice(0,1,this.list.unselected[t]),this.form.selectedIds=this.list.selected[0].id,void this.getList();this.list.selected.splice(0,1,this.list.unselected[t]),this.form.selectedIds=this.list.selected.map(function(t){return t.id}).join(","),this.$emit("changetext",this.list.unselected[t])},remove:function(t){this.list.selected.splice(t,1),this.form.selectedIds=this.list.selected.map(function(t){return t.id}).join(","),this.getList()}},created:function(){},watch:{"form.selectedIds":function(){this.$emit("input",this.list)},channelIds:function(t){this.form.channelId=t.join(","),this.getList()}}},a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"option-item add-relates",staticStyle:{"border-bottom":"0"}},[s("div",{staticClass:"flex-v-center blue a",on:{click:t.clickget}},[s("i",{staticClass:"icon f-20 add-other-icon"},[t._v(t._s(t.icon))]),t._v(" "),s("span",{staticClass:"flex-item"},[t._v("添加链接")]),t._v(" "),t._t("afterTitle")],2),t._v(" "),t.list.selected.length?s("ul",{staticStyle:{"margin-top":"10px"}},[s("draggable",{attrs:{element:"ul",options:{ghostClass:"movelist"}},model:{value:t.list.selected,callback:function(e){t.$set(t.list,"selected",e)},expression:"list.selected"}},t._l(t.list.selected,function(e,i){return s("li",{key:e.id,staticClass:"flex-v-center item",attrs:{title:e.title}},[s("span",{staticStyle:{"margin-right":"10px"}},[t._v(t._s(e.title))]),t._v(" "),s("span",{staticClass:"flex-item"}),t._v(" "),s("i",{staticClass:"icon a",staticStyle:{"font-size":"18px"},on:{click:function(e){t.remove(i)}}},[t._v("delete")])])}))],1):t._e(),t._v(" "),t._t("default"),t._v(" "),s("layer",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],attrs:{title:"添加"+t.title,width:"800px","mask-click":""},on:{close:function(e){t.show=!1}}},[s("div",{staticClass:"layer-text bg-e relative"},[s("transition",{attrs:{name:"fade"}},[t.loading?s("div",{staticClass:"flex-center abs bg-e",staticStyle:{"z-index":"10"}},[s("loading")],1):t._e()]),t._v(" "),s("div",{staticClass:"flex-v-center"},[s("input-box",{ref:"searchTitle",attrs:{label:"搜索标题"},on:{blur:t.searchTitle},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.$refs.searchTitle.$refs.input.blur()}},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}}),t._v(" "),s("div",{staticClass:"relative"},[s("span",{staticClass:"a",staticStyle:{color:"rgba(0 ,0 ,0, .4)"},on:{click:function(e){t.channelShow=!t.channelShow}}},[t._v("筛选频道"),s("i",{staticClass:"icon"},[t._v("keyboard_arrow_down")])]),t._v(" "),t.channelShow?s("bubble",{on:{close:function(e){t.channelShow=!1}}},[s("div",{staticStyle:{padding:"10px 0",width:"280px"}},[s("tree",{attrs:{data:t.channels,"pid-txt":"channelPartentId",nameTxt:"channelName","show-checkbox":"","checked-list":t.channelIds},on:{"update:checkedList":function(e){t.channelIds=e}}})],1)]):t._e()],1)],1),t._v(" "),s("div",{staticClass:"flex"},[s("div",{staticClass:"flex-item",staticStyle:{"margin-right":"10px"}},[s("div",{staticClass:"title"},[t._v("点击选取")]),t._v(" "),s("ul",{staticClass:"content"},[t.list.unselected.length?t._e():s("li",{staticClass:"flex-center none"},[s("no-data")],1),t._v(" "),t._l(t.list.unselected,function(e,i){return s("li",{key:e.id,on:{click:function(e){t.select(i)}}},[s("div",[t._v(t._s(e.title))])])})],2)]),t._v(" "),s("div",{staticClass:"flex-item"},[s("div",{staticClass:"title"},[t._v("已选取")]),t._v(" "),s("ul",{staticClass:"content"},[t.list.selected.length?t._e():s("li",{staticClass:"flex-center none"},[s("no-data")],1),t._v(" "),t._l(t.list.selected,function(e,i){return s("li",{key:e.id,on:{click:function(e){t.remove(i)}}},[s("div",[t._v(t._s(e.title))])])})],2)])])],1)])],2)};a._withStripped=!0;var l={render:a,staticRenderFns:[]},o=l;var c=!1;var d=s("VU/8")(n,o,!1,function(t){c||s("K5+Q")},null,null);d.options.__file="src/apps/push/relates.vue";var r=d.exports,h=s("WUXh"),u=s("PJh5"),f=s.n(u),p={components:{AppArticleAddRelates:r,VueDatepickerLocal:h.a},data:function(){return{getif:!1,list:[],device:0,sites:"",delayPush:0,text:"",delayPushTime:new Date,sitesList:[],ui:{channelIds:""},form:{channelIds:null}}},computed:{channelIds:{get:function(){return""===this.form.channelIds?[]:this.form.channelIds.split(",")},set:function(t){this.form.channelIds=t.join(",")}},channelNames:function(){var t=this;return this.channelIds.length?this.channelIds.map(function(e){return t.ui.channels.find(function(t){return t.id===e}).channelName}).join("，"):"选择栏目"}},beforeMount:function(){this.getChannels(),this.getSites(),this.sites=sessionStorage.getItem("siteId")+""},methods:{getSites:function(){var t=this;this.$http.post("/cri-cms-platform/sites.monitor").then(function(e){t.sitesList=e.sites||[]})},getChannels:function(){var t=this;this.$http.post("/cri-cms-platform/sysRoles/getChannels.monitor").then(function(e){t.ui.channels=e||[],t.getif=!0}).catch(function(t){console.log(t)})},changetext:function(t){this.text=t.title},submit:function(){var t=this,e={contentId:this.list.selected[0].id,content:this.text,device:0==this.device?"1,2":this.device,sites:this.sites,delayPush:this.delayPush,delayPushTime:1==this.delayPush?f()(this.delayPushTime).format("YYYY-MM-DD HH:mm:ss"):""};e.contentId?e.content?!e.content.length>140?this.$toast("推送内容最多为140字"):this.$http.post("/cri-cms-platform/appPush/save.monitor",e).then(function(e){console.log(e),t.$toast("推送成功"),t.list.selected=[],t.text="",t.device=0,t.delayPush=0,t.delayPushTime=new Date}):this.$toast("请填写推送内容"):this.$toast("请选择关联文章")}}},v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-sites flex-col c-6"},[t._m(0),t._v(" "),s("div",{staticClass:"flex-item scroll-y bg-e relative"},[s("div",{staticClass:"box"},[s("textarea",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"text"}],attrs:{placeholder:"推送内容..."},domProps:{value:t.text},on:{input:function(e){e.target.composing||(t.text=e.target.value)}}}),t._v(" "),s("div",{staticStyle:{"text-align":"right",display:"block","margin-bottom":"20px"}},[s("span",{style:{color:t.text.length>140?"#F44336":"#999"}},[t._v(t._s(t.text.length)+" / 140")])]),t._v(" "),s("div",{staticClass:"push_box"},[s("div",{staticClass:"radio_box_push"},[s("span",[t._v("推送方式：")]),t._v(" "),s("div",{staticClass:"flex-item"},[s("radio-box",{attrs:{text:"全部推送",label:0},model:{value:t.device,callback:function(e){t.device=e},expression:"device"}})],1),t._v(" "),s("div",{staticClass:"flex-item"},[s("radio-box",{attrs:{text:"安卓",label:1},model:{value:t.device,callback:function(e){t.device=e},expression:"device"}})],1),t._v(" "),s("div",{staticClass:"flex-item"},[s("radio-box",{attrs:{text:"IOS",label:2},model:{value:t.device,callback:function(e){t.device=e},expression:"device"}})],1)]),t._v(" "),s("div",{staticClass:"radio_box_push"},[s("span",[t._v("推送站点：")]),t._v(" "),s("div",{staticClass:"flex-item"},[s("radio-box",{attrs:{text:"全部站点",label:"all"},model:{value:t.sites,callback:function(e){t.sites=e},expression:"sites"}})],1),t._v(" "),t._l(t.sitesList,function(e){return s("div",{staticClass:"flex-item"},[s("radio-box",{attrs:{text:e.siteName,label:e.siteId},model:{value:t.sites,callback:function(e){t.sites=e},expression:"sites"}})],1)})],2),t._v(" "),s("div",{staticClass:"radio_box_push"},[s("span",[t._v("延迟推送：")]),t._v(" "),s("div",{staticClass:"flex-item"},[s("radio-box",{attrs:{text:"是",label:1},model:{value:t.delayPush,callback:function(e){t.delayPush=e},expression:"delayPush"}})],1),t._v(" "),s("div",{staticClass:"flex-item"},[s("radio-box",{attrs:{text:"否",label:0},model:{value:t.delayPush,callback:function(e){t.delayPush=e},expression:"delayPush"}})],1),t._v(" "),1==t.delayPush?s("span",{staticStyle:{float:"right"}},[t._v("\n            时间：\n            "),s("vue-datepicker-local",{attrs:{"show-buttons":"",clearable:"",format:"YYYY-MM-DD HH:mm:ss"},model:{value:t.delayPushTime,callback:function(e){t.delayPushTime=e},expression:"delayPushTime"}})],1):t._e()]),t._v(" "),s("div",{staticClass:"radio_box_push"}),t._v(" "),s("div",{staticStyle:{display:"flex","align-items":"start","justify-content":"space-between"}},[t.getif?s("app-article-add-relates",{attrs:{channels:t.ui.channels.channels,channelId:t.form.channelIds,title:"文章",icon:"book",url:"/cri-cms-platform/special/getArticList.monitor"},on:{changetext:t.changetext},model:{value:t.list,callback:function(e){t.list=e},expression:"list"}}):t._e(),t._v(" "),s("btn",{on:{click:t.submit}},[t._v("推送")])],1)])])])])};v._withStripped=!0;var x={render:v,staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"af-topbar"},[e("span",{staticClass:"f-18"},[this._v("创建推送")])])}]},m=x;var b=!1;var _=s("VU/8")(p,m,!1,function(t){b||s("cLt5")},"data-v-79194fa0",null);_.options.__file="src/apps/push/add.vue";e.default=_.exports},cLt5:function(t,e,s){var i=s("uFfJ");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);s("rjj0")("687eb370",i,!1,{})},uFfJ:function(t,e,s){(t.exports=s("FZ+f")(!1)).push([t.i,"\n.box[data-v-79194fa0]{\n  max-width: 1000px;\n  margin: 0 auto;\n  padding-top: 50px;\n}\n.box textarea[data-v-79194fa0]{\n  width: 100%;\n  border: 1px solid #ddd;\n  border-radius: 10px;\n  padding: 10px;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  outline: none;\n  resize: none;\n  height: 100px;\n}\n.box>div[data-v-79194fa0]{\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: start;\n  -webkit-box-pack: justify;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n}\n.operlog_list[data-v-79194fa0]{\n  width: calc(100% - 200px);\n}\n.search_navbox[data-v-79194fa0]{\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: justify;\n      -ms-flex-pack: justify;\n          justify-content: space-between;\n}\n.search_navbox .datepicker-range .datepicker-popup[data-v-79194fa0]{\n  width: 415px !important;\n}\n.radio_box_push[data-v-79194fa0]{\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  -webkit-box-pack: start !important;\n      -ms-flex-pack: start !important;\n          justify-content: flex-start !important;\n  margin-bottom: 20px;\n}\n.radio_box_push .flex-item[data-v-79194fa0]{\n  max-width: 200px;\n}\n.push_box[data-v-79194fa0]{\n  padding: 20px;\n  background: #fff;\n  display: block !important;\n  border-radius: 10px;\n}\n",""])}});